### Content
- [Wi-Fi Authentication Types](#wi-fi-authentication-types)
	- [Authentication Methods](#authentication-methods)
- [802.11 Frames and Types](#802.11-frames-and-types)
	- [The IEEE 802.11 MAC Frame](#the-ieee-802.11-mac-frame)
	- [IEEE 802.11 Frame Types](#ieee-802.11-frame-types)
	- [The Connection Cycle](#the-connection-cycle)
- [Components of WiFi Penetration test](#components-of-wifi-penetration-test)
---
# Wi-Fi Authentication Types
<img src="https://academy.hackthebox.com/storage/modules/222/Wifi_auth_types.png" style="hight:50%; width:70%;">

- `WEP (Wired Equivalent Privacy)`: The original WiFi security protocol, `WEP` Provides basic encryption and considered outdated and insecure.
- `WPA (WiFi Protected Access)`: Introduced as an improvement over `WEP`, `WPA` Offers better encryption through `TKIP (Tempora Key Integrity Protocol)`, Not secure enough.
- `WPA2`: Advanced `WPA`, `WPA2` Uses `AES` and has been the standard for many years.
- `WPA3`: The latest standard, `WPA3` enhances security with data encryption and password-based authentication. The most secure option currently.
## Authentication Methods
<img src="https://academy.hackthebox.com/storage/modules/222/Auth_Methods/auth_methods_.png" style="height:70%; width:70%;">

Two primary authentication methods used in WiFi protocols are `Open System Authentication` and `Shared Key authentication`, there are many other methods exist, especially in enterprise environment or with advanced protocols like `WPA3` and `Enhanced Open`.
### Open System Authentication
Doesn't require any shared secret or creds for initial access. commonly found on open public networks.

<img src="https://academy.hackthebox.com/storage/modules/222/Auth_Methods/Open_system.png" style="width:60%; height:60%;">

### Shared Key Authentication
The client and access point prove their identities through the computation of a challenge.
This method is often associated with Wired Equivalent Privacy (`WEP`) and Wi-Fi Protected Access (`WPA`).

<img src="https://academy.hackthebox.com/storage/modules/222/Auth_Methods/Shared_auth.png" style="width:60%; height:60%;">

#### Authentication with WEP
<img src="https://academy.hackthebox.com/storage/modules/222/Auth_Methods/Wep_process.png" style="width:60%; height:60%;">

#### Authentication with WPA
1. `Authentication Request:` The client sends an authentication request to the AP to initiate the authentication process.
2. `Authentication Response:` The AP responds with an authentication response, which indicates that it is ready to proceed with authentication.
3. `Pairwise Key Generation:` The client and the AP then calculate the PMK from the PSK (password).
4. `Four-Way Handshake:` The client and access point then undergo each step of the four way handshake, which involves nonce exchange, derivation, among other actions to verify that the client and AP truly know the PSK.

<img src="https://academy.hackthebox.com/storage/modules/222/Auth_Methods/Wpa_process.png" style="width:60%; height:60%;">

- Shared key authentication type also involves [WPA3](https://documentation.meraki.com/MR/Wi-Fi_Basics_and_Best_Practices/WPA3_Encryption_and_Configuration_Guide), the latest and most secure WiFi security standard.
	- One of its key features is `Simultaneous Authentication of Equals (SAE)`, which replaces the `Pre-Shared Key (PSK)` method used in WPA2, providing better protection for passwords and individual data sessions.
	- `WPA3` adoption has been slower due to hardware restrictions
---
# 802.11 Frames and Types
In 802.11 communications, there are a few different frame types utilized for different actions which are all a part of the connection cycle and standard communications for these wireless networks.
### The IEEE 802.11 MAC Frame
- All 802.11 frames utilize the MAC frame.
- It's the foundation for all other fields and actions performed between the client and access point, even in customized networks.
- Consists of 9 fields.

| Field                  | Description                                                                                                                                                                                                                                    |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Frame Control          | Contains information such as type, subtype, protocol version, to ds (distribution system), from DS, Order, etcetera.                                                                                                                           |
| Duration/ID            | This ID clarifies the amount of time in which the wireless medium is occupied.                                                                                                                                                                 |
| Address 1, 2, 3, and 4 | These fields clarify the MAC addresses involved in the communication, but they could mean different things depending on the origin of the frame. These tend to include the BSSID of the access point and the client MAC address, among others. |
| SC                     | The sequence control field allows additional capabilities to prevent duplicate frames.                                                                                                                                                         |
| Data                   | Simply put, this field is responsible for the data that is transmitted from the sender to the receiver.                                                                                                                                        |
| CRC                    | The cyclic redundancy check contains a 32-bit checksum for error detection.                                                                                                                                                                    |
### IEEE 802.11 Frame Types
IEEE frames can be put into different categories for what they do and what actions they are involved in.
1. `Management (00)`: These frames are used for management and control, and allowing the access point and client to control the active connection.
	1. `Beacon Frames (1000)`: Used by the access point to communicate its presence to the client or station. It includes information such as supported ciphers, authentication types, its SSID, and supported data rates among others.
	2. `Probe Request (0100) and Probe Response (0101)`: Exist to allow the client to discover nearby access points. If a network is hidden or not hidden, a client will send a probe request with the SSID of the access point. The access point will then respond with information about itself for the client.
	3. `Authentication Request and Response (1011)`: Sent by the client to the access point to begin the connection process. These frames are primarily used to identify the client to the access point.
	4. `Association/Reassociation Request and Responses (0000, 0001, 0010, 0011)`: After sending an authentication request and undergoing the authentication process, the client sends an association request to the access point. The access point then responds with an association response to indicate whether the client is able to associate with it or not.
	5. `Disassociation/Deauthentication (1010, 1100)`: Sent from the access point to the client. Similar to their inverse frames (association and authentication), they are designed to terminate the connection between the access point and the client. These frames additionally contain what is known as a reason code. This reason code indicates why the client is being disconnected from the access point. We utilize crafting these frames for many handshake captures and denial of service based attacks during wi-fi penetration testing efforts.
2. `Control (01)`: Control frames are used for managing the transmission and reception of data frames within wi-fi networks. We can consider them like a sense of quality control.
3. `Data (10)`: Data frames are used to contain data for transmission.
### The Connection Cycle
A typical connection process between client and access point (`WPA2` Focused)
1. `Beacon Frames`
2. `Probe Request and Response`
3. `Authentication Request and Response`
4. `Association Request and Response`
5. `Some form of handshake or other security mechanism`
6. `Disassociation/Deauthentication`

Beacon frames from the access point can be viewed using filter `(wlan.fc.type == 0) && (wlan.fc.type_subtype == 8)`.
<img src="https://academy.hackthebox.com/storage/modules/222/001_beacon.PNG">

Probe **request** frames from the access point can be viewed using filter `(wlan.fc.type == 0) && (wlan.fc.type_subtype == 4)`.
<img src="https://academy.hackthebox.com/storage/modules/222/002_probe_request.PNG">

Probe **response** frames from the access point can be viewed using filter `(wlan.fc.type == 0) && (wlan.fc.type_subtype == 5)`.
<img src="https://academy.hackthebox.com/storage/modules/222/003_probe_response.PNG">

The authentication process between the client and the access point can be viewed using filter `(wlan.fc.type == 0) && (wlan.fc.type_subtype == 11)`.
<img src="https://academy.hackthebox.com/storage/modules/222/004_authentication.PNG">

After the authentication process is complete, the station's association request can be viewed using filter `(wlan.fc.type == 0) && (wlan.fc.type_subtype == 0)`.
<img src="https://academy.hackthebox.com/storage/modules/222/005_association_request.PNG">

The access point's association response can be viewed using filter `(wlan.fc.type == 0) && (wlan.fc.type_subtype == 1)`.
<img src="https://academy.hackthebox.com/storage/modules/222/006_association_response.PNG">

If the example network uses WPA2, the EAPOL (handshake) frames can be viewed using filter `eapol`.
<img src="https://academy.hackthebox.com/storage/modules/222/007_handshake.PNG">

Termination of the connection can be viewed by identifying which party (client or access point) initiated the disconnection.
Disassociation frames (10) or Deauthentication frames (12) can be viewed using filter: 
`(wlan.fc.type == 0) && (wlan.fc.type_subtype == 12) or (wlan.fc.type_subtype == 10)`
<img src="https://academy.hackthebox.com/storage/modules/222/008_Disassociation.PNG">

---
# Components of WiFi Penetration test

1. `Evaluating Passphrases`: Asses the security of WiFi network through techniques like dictionary attacks, brute force attacks, and password cracking tools to evaluate the resilience of passphrases against unauthorized access.
2. `Evaluationg Configuration`: Analyze the configuration settings of WiFi routers and access points to identify potential security vulnerabilities. Including encryption protocols, authentication methods, network segmentation, and other configurations to ensure they adhere to best security practices.
3. `Test the Infrastructure`: Conduct comprehensive assessments to uncover weaknesses in network architecture, device configurations, firmware versions, and implementation flaws that could be exploited by attackers.
4. `Testing the Clients`: Evaluate the security posture of WiFi clients, such as laptops, smartphones, and IoT devices, that connect to the network. This involves testing for vulnerabilities in client software, operating systems, wireless drivers, and network stack implementations to identify potential entry points for attackers.
---
